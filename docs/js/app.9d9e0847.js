(function(e){function t(t){for(var r,a,s=t[0],c=t[1],u=t[2],f=0,p=[];f<s.length;f++)a=s[f],Object.prototype.hasOwnProperty.call(o,a)&&o[a]&&p.push(o[a][0]),o[a]=0;for(r in c)Object.prototype.hasOwnProperty.call(c,r)&&(e[r]=c[r]);l&&l(t);while(p.length)p.shift()();return i.push.apply(i,u||[]),n()}function n(){for(var e,t=0;t<i.length;t++){for(var n=i[t],r=!0,s=1;s<n.length;s++){var c=n[s];0!==o[c]&&(r=!1)}r&&(i.splice(t--,1),e=a(a.s=n[0]))}return e}var r={},o={app:0},i=[];function a(t){if(r[t])return r[t].exports;var n=r[t]={i:t,l:!1,exports:{}};return e[t].call(n.exports,n,n.exports,a),n.l=!0,n.exports}a.m=e,a.c=r,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/text-marker/";var s=window["webpackJsonp"]=window["webpackJsonp"]||[],c=s.push.bind(s);s.push=t,s=s.slice();for(var u=0;u<s.length;u++)t(s[u]);var l=c;i.push([0,"chunk-vendors"]),n()})({0:function(e,t,n){e.exports=n("cd49")},"196f":function(e,t,n){},"19a9":function(e,t,n){"use strict";n("c403")},"5c0b":function(e,t,n){"use strict";n("9c0c")},"9c0c":function(e,t,n){},a7dd:function(e,t,n){},c403:function(e,t,n){},cd49:function(e,t,n){"use strict";n.r(t);var r=n("2b0e"),o=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{attrs:{id:"app"}},[n("TextMarker",{attrs:{rawText:e.rawText,ranges:e.ranges,options:e.options},on:{"update:ranges":function(t){e.ranges=t},removeMark:e.onRemoveMark,addMark:e.onAddMark}})],1)},i=[],a=n("9ab4"),s=n("60a3"),c=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"text-mark"},[n("p",{ref:"paragraph",staticClass:"paragraph"}),n("Popover",e._b({},"Popover",e.popover,!1),["add"===e.popoverType?n("div",{staticClass:"add-mark",on:{click:e.addMark}},[n("Icon",{attrs:{type:"plus"}}),e._v("添加标注 ")],1):e._e(),"remove"===e.popoverType?n("div",{staticClass:"remove-mark"},[e._v(" "+e._s(e.popoverText)+" "),n("Icon",{attrs:{type:"close"},nativeOn:{click:function(t){return e.removeMark.apply(null,arguments)}}})],1):e._e()]),n("Dropdown",e._b({attrs:{options:e.options},on:{select:e.onSelect}},"Dropdown",e.dropdown,!1))],1)},u=[];function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&f(e.prototype,t),n&&f(e,n),e}var h=function(){function e(){l(this,e),this.events={}}return p(e,[{key:"on",value:function(e,t){this.events[e]=this.events[e]||[],this.events[e].push(t)}},{key:"off",value:function(e,t){if(this.events[e]){var n=this.events[e].findIndex((function(e){return e===t}));this.events[e].splice(n,1)}}},{key:"emit",value:function(e,t){this.events[e]&&this.events[e].forEach((function(e){e(t)}))}},{key:"clear",value:function(){var e=this;Object.keys(this.events).forEach((function(t){delete e.events[t]}))}}]),e}(),d=h;function v(e){return v="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function b(e,t,n){return t&&y(e.prototype,t),n&&y(e,n),e}function m(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&w(e,t)}function w(e,t){return w=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},w(e,t)}function x(e){var t=S();return function(){var n,r=j(e);if(t){var o=j(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return O(this,n)}}function O(e,t){return!t||"object"!==v(t)&&"function"!==typeof t?k(e):t}function k(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function S(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function j(e){return j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},j(e)}function T(e){return e&&1===e.nodeType&&"SPAN"===e.nodeName}function _(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(var n=0;n<e.length;n++){var r=e[n],o=t[n];if(r!==o){var i=Object.keys(r),a=Object.keys(o);if(i.length!==a.length)return!1;for(var s=0;s<i.length;s++){var c=i[s];if(r[c]!==o[c])return!1}}}return!0}var R,C,P=function(e){m(n,e);var t=x(n);function n(e){var r;return g(this,n),r=t.call(this),r.container=e,r.ranges=[],r.rawText="",r.onMouseUp=function(e){var t=window.getSelection();if(t){var n=t.getRangeAt(0),o=n.startContainer,i=n.endContainer,a=n.startOffset,s=n.endOffset;if(a!==s&&o===i&&o.parentNode===r.container){var c=o.previousSibling;if(c&&T(c)){var u=Number(c.getAttribute("data-end"));a+=u,s+=u}var l=r.insertRange(a,s);setTimeout((function(){var e=r.ranges[l];r.emit("range:insert",{index:l,range:e})})),e.stopPropagation()}}},r.onClick=function(e){if(e.target&&T(e.target)){var t=window.getSelection();if(t){var n=t.getRangeAt(0),o=n.startOffset,i=n.endOffset;if(i>o)return}e.stopPropagation();var a=e.target,s=Number(a.getAttribute("data-index")),c=r.ranges[s];r.emit("range:click",{index:s,range:c})}},r.container.addEventListener("mouseup",r.onMouseUp),r.container.addEventListener("click",r.onClick),r}return b(n,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];_(this.ranges,t)&&e===this.rawText||(this.rawText=e,this.ranges=t.map((function(t){var n=t.start,r=t.end,o=t.data;if("number"!==typeof n||"number"!==typeof r)throw new Error("start、end字段必须是数字");return{start:n,end:r,data:o,text:e.slice(n,r)}})),this.emit("ranges:update",this.ranges),this.renderHTML())}},{key:"insertRange",value:function(e,t){var n=this.ranges.length;while(n>0){n--;var r=this.ranges[n];if(r.end<=e){n++;break}}return this.ranges.splice(n,0,{start:e,end:t,text:this.rawText.slice(e,t),data:""}),this.emit("ranges:update",this.ranges),this.renderHTML(),n}},{key:"getRangeIndex",value:function(e){return this.ranges.findIndex((function(t){return t===e}))}},{key:"removeRange",value:function(e){if("number"===typeof e){var t=this.ranges.splice(e,1)[0];return this.emit("ranges:update",this.ranges),t&&this.renderHTML(),t}var n=this.getRangeIndex(e);return n>-1&&(this.ranges.splice(n,1),this.emit("ranges:update",this.ranges),this.renderHTML()),n}},{key:"renderHTML",value:function(){var e=this,t=0,n="";this.ranges.forEach((function(r,o){n+=e.rawText.slice(t,r.start),n+='<span class="default"\n                     data-data="'.concat(r.data,'"\n                     data-index="').concat(o,'"\n                     data-start="').concat(r.start,'" \n                     data-end="').concat(r.end,'">').concat(e.rawText.slice(r.start,r.end),"</span>"),t=r.end})),n+=this.rawText.slice(t),this.container.innerHTML=n}},{key:"getRangeBBox",value:function(e){var t=-1;t="number"===typeof e?e:this.getRangeIndex(e);var n="span[data-index='".concat(t,"']"),r=this.container.querySelector(n);return r?r.getClientRects()[0]:(console.warn("不存在：".concat(n)),null)}},{key:"getBBox",value:function(){return this.container.getBoundingClientRect()}},{key:"getRangePosition",value:function(e){var t=this.getRangeBBox(e);if(!t)return null;var n=this.getBBox();return{left:t.left-n.left,top:t.top-n.top,width:t.width,height:t.height}}},{key:"getRangeElement",value:function(e){var t=this.getRangeIndex(e),n="span[data-index='".concat(t,"']"),r=this.container.querySelector(n);return r||(console.warn("不存在：".concat(n)),null)}},{key:"destroy",value:function(){this.container.removeEventListener("mouseup",this.onMouseUp),this.container.removeEventListener("click",this.onClick),this.clear()}}]),n}(d),M=P,E=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"popover",style:e.containerStyle,on:{mouseup:function(e){e.stopPropagation()}}},[n("div",{ref:"content",staticClass:"popover-content",style:e.contentStyle},[e._t("default")],2),n("i",{staticClass:"popover-arrow",style:e.arrowStyle})])},A=[],$={props:{color:{type:String,default:"#fff"},visible:{type:Boolean,default:!1},top:{type:Number,default:0},left:{type:Number,default:0}},data:function(){return{}},computed:{containerStyle:function(){return{left:"".concat(this.left,"px"),top:"".concat(this.top,"px")}},contentStyle:function(){return{backgroundColor:this.color}},arrowStyle:function(){return{borderTopColor:this.color}}},watch:{visible:function(){if(this.visible){var e=this.$el,t=e.parentElement,n=this.$refs.content;Object.assign(e.style,{transform:"translate3d(0, -30px, 0)",opacity:.5}),Object.assign(n.style,{transform:"translate(-50%, 0)"}),requestAnimationFrame((function(){var r=t.getBoundingClientRect(),o=n.getBoundingClientRect(),i=-o.width/2;o.left<r.left?i+=r.left-o.left:o.right>r.right&&(i+=r.right-o.right),Object.assign(n.style,{transform:"translate(".concat(i,"px, 0)")}),Object.assign(e.style,{transform:"translate3d(0, -40px, 0)",opacity:1})}))}}}},B=$,L=(n("efc6"),n("2877")),I=Object(L["a"])(B,E,A,!1,null,"6e1edb3f",null),D=I.exports,q=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"show",rawName:"v-show",value:e.visible,expression:"visible"}],staticClass:"dropdown-menu",on:{mouseup:function(e){e.stopPropagation()}}},[n("ul",[e._l(e.options,(function(t){return n("li",{key:t.value,staticClass:"menu-item",attrs:{title:t.label},on:{click:function(n){return e.onMenuClick(t.value)}}},[e._v(" "+e._s(t.label)+" ")])})),e.options.length?e._e():n("li",{key:"_no_data_",staticClass:"no-data"},[e._v("暂无数据")])],2)])},H=[],N=n("39c3"),F={props:{options:{type:Array,default:function(){return[]}},visible:{type:Boolean,default:!1},reference:{type:HTMLElement,default:null}},watch:{visible:function(){this.visible&&this.$el&&this.reference&&(this.popper&&this.popper.destroy(),this.popper=Object(N["a"])(this.reference,this.$el,{placement:"auto-start"}))}},mounted:function(){document.body.appendChild(this.$el)},beforeDestroy:function(){this.popper&&this.popper.destroy(),document.body.removeChild(this.$el)},methods:{onMenuClick:function(e){this.$emit("select",e)}}},U=F,z=(n("19a9"),Object(L["a"])(U,q,H,!1,null,"651ec8e6",null)),J=z.exports,V=r["a"].extend({name:"icon",props:{type:{type:String,default:"close"}},render:function(){var e=arguments[0];switch(this.type){case"close":return e("svg",{attrs:{viewBox:"64 64 896 896","data-icon":"close",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",focusable:"false"},class:"icon-close"},[e("path",{attrs:{d:"M563.8 512l262.5-312.9c4.4-5.2.7-13.1-6.1-13.1h-79.8c-4.7 0-9.2 2.1-12.3 5.7L511.6 449.8 295.1 191.7c-3-3.6-7.5-5.7-12.3-5.7H203c-6.8 0-10.5 7.9-6.1 13.1L459.4 512 196.9 824.9A7.95 7.95 0 0 0 203 838h79.8c4.7 0 9.2-2.1 12.3-5.7l216.5-258.1 216.5 258.1c3 3.6 7.5 5.7 12.3 5.7h79.8c6.8 0 10.5-7.9 6.1-13.1L563.8 512z"}})]);case"plus":return e("svg",{attrs:{viewBox:"64 64 896 896","data-icon":"plus",width:"1em",height:"1em",fill:"currentColor","aria-hidden":"true",focusable:"false"},class:"icon-plus"},[e("path",{attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}}),e("path",{attrs:{d:"M176 474h672q8 0 8 8v60q0 8-8 8H176q-8 0-8-8v-60q0-8 8-8z"}})]);default:return null}}}),G=V,K=Object(L["a"])(G,R,C,!1,null,null,null),Q=K.exports;function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function X(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){Y(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Z(e){return re(e)||ne(e)||te(e)||ee()}function ee(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function te(e,t){if(e){if("string"===typeof e)return oe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?oe(e,t):void 0}}function ne(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function re(e){if(Array.isArray(e))return oe(e)}function oe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ie=["#607AE3","#FD4A4A","#31CCB9","#FE9A35","#8F68DF","#45C26A"],ae=r["a"].extend({name:"text-marker",components:{Dropdown:J,Popover:D,Icon:Q},props:{rawText:{type:String,default:""},ranges:{type:Array,default:function(){return[]}},options:{type:Array,default:function(){return[]}}},data:function(){return{popoverType:"add",popoverText:"",popover:{visible:!1,color:"",left:0,top:0},dropdown:{visible:!1,left:0,top:0},range:void 0,textSelection:void 0}},mounted:function(){var e=this.$refs.paragraph;this.textSelection=new M(e),this.textSelection.init(this.rawText,this.ranges),this.textSelection.on("range:insert",this.onRangeInsert),this.textSelection.on("range:click",this.onRangeClick),document.addEventListener("mouseup",this.onDocClick)},beforeDestroy:function(){this.textSelection&&this.textSelection.destroy(),document.removeEventListener("mouseup",this.onDocClick)},watch:{ranges:function(){this.textSelection.init(this.rawText,this.ranges)},rawText:function(){this.textSelection.init(this.rawText,this.ranges)}},methods:{onRangeInsert:function(e){var t=this,n=e.range;this.range&&!this.range.data&&this.textSelection.removeRange(this.range),this.popover.visible=!1,this.$nextTick((function(){var e=t.textSelection.getRangePosition(n);if(e){t.dropdown.visible=!1,t.popoverType="add";var r=t.textSelection.getRangeIndex(n);t.popover.color=t.getColor(r),t.popover.left=e.left+e.width/2,t.popover.top=e.top,t.popover.visible=!0,t.range=n}}))},onRangeClick:function(e){var t=this,n=e.range;this.popover.visible=!1,this.$nextTick((function(){t.popoverType="remove";var e=t.options.find((function(e){return e.value===n.data}));t.popoverText=e?e.label:n.data,t.range&&!t.range.data&&t.textSelection.removeRange(t.range),t.range=n;var r=t.textSelection.getRangePosition(n);if(r){var o=t.textSelection.getRangeIndex(n);Object.assign(t.popover,{visible:!0,color:t.getColor(o),left:r.left+r.width/2,top:r.top})}}))},onSelect:function(e){this.range&&(this.range.data=e,this.dropdown.visible=!1,this.textSelection.renderHTML(),this.$emit("update:ranges",Z(this.textSelection.ranges)),this.$emit("change",Z(this.textSelection.ranges)),this.$emit("addMark",X({},this.range)),this.range=null)},onDocClick:function(){this.range&&!this.range.data&&(this.textSelection.removeRange(this.range),this.range=null),this.dropdown.visible=!1,this.popover.visible=!1},addMark:function(){this.range&&(this.popover.visible=!1,Object.assign(this.dropdown,{visible:!0,reference:this.textSelection.getRangeElement(this.range)}))},removeMark:function(){this.range&&(this.popover.visible=!1,this.textSelection.removeRange(this.range),this.$emit("update:ranges",Z(this.textSelection.ranges)),this.$emit("change",Z(this.textSelection.ranges)),this.$emit("removeMark",X({},this.range)))},getColor:function(e){return ie[e%ie.length]}}}),se=ae,ce=(n("cfd9"),Object(L["a"])(se,c,u,!1,null,"0860535a",null)),ue=ce.exports,le=ue;le.install=function(e){e.component(ue.name,ue)},le.version="0.1.0";var fe=le;function pe(e){return pe="function"===typeof Symbol&&"symbol"===typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"===typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},pe(e)}function he(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function de(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function ve(e,t,n){return t&&de(e.prototype,t),n&&de(e,n),e}function ge(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&ye(e,t)}function ye(e,t){return ye=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},ye(e,t)}function be(e){var t=xe();return function(){var n,r=Oe(e);if(t){var o=Oe(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return me(this,n)}}function me(e,t){return!t||"object"!==pe(t)&&"function"!==typeof t?we(e):t}function we(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function xe(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function Oe(e){return Oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},Oe(e)}var ke=function(e){ge(n,e);var t=be(n);function n(){var e;return he(this,n),e=t.apply(this,arguments),e.rawText="用户可能从左到右（与文档方向相同）连续空格start         连续空格end（与文档方向相反）选择文本。anchor 指向用户开始选择的地方，而 focus 指向用户结束选择的地方。如果你使用鼠标选择文本的话，anchor 就指向你按下鼠标键的地方，而 focus 就指向你松开鼠标键的地方。anchor 和 focus 的概念不能与选区的起始位置和终止位置混淆，因为 anchor 指向的位置可能在 focus 指向的位置的前面，也可能在 focus 指向位置的后面，这取决于你选择文本时鼠标移动的方向（也就是按下鼠标键和松开鼠标键的位置）。",e.ranges=[{start:5,end:15,data:"@日期"},{start:20,end:32,data:"@日期"}],e.options=[{label:"@日期123123123",value:"@日期"},{label:"@时间",value:"@时间"},{label:"@地名",value:"@地名"}],e}return ve(n,[{key:"onRemoveMark",value:function(e){console.log("remove",e)}},{key:"onAddMark",value:function(e){console.log("add",e)}}]),n}(s["b"]);ke=Object(a["a"])([Object(s["a"])({components:{TextMarker:fe}})],ke);var Se=ke,je=Se,Te=(n("5c0b"),Object(L["a"])(je,o,i,!1,null,null,null)),_e=Te.exports;r["a"].config.productionTip=!1,new r["a"]({render:function(e){return e(_e)}}).$mount("#app")},cfd9:function(e,t,n){"use strict";n("196f")},efc6:function(e,t,n){"use strict";n("a7dd")}});
//# sourceMappingURL=app.9d9e0847.js.map